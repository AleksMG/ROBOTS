<!DOCTYPE html>
<html>
<head>
    <title>Бильярдный бой шаров</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #121212;
            color: white;
            margin: 0;
            padding: 20px;
        }
        #arena {
            width: 800px;
            height: 500px;
            margin: 20px auto;
            background: #0a0a0a;
            border: 3px solid #333;
            position: relative;
            overflow: hidden;
        }
        .ball {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            transform: translate(-50%, -50%);
            transition: transform 0.05s linear;
        }
        #ball1 {
            background: radial-gradient(circle at 30% 30%, #2196F3, #0d47a1);
            box-shadow: 0 0 10px #2196F3;
        }
        #ball2 {
            background: radial-gradient(circle at 30% 30%, #FF5722, #bf360c);
            box-shadow: 0 0 10px #FF5722;
        }
        .bullet {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            position: absolute;
            background: yellow;
            transform: translate(-50%, -50%);
        }
        .hit-effect {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 0, 0.7);
            transform: translate(-50%, -50%);
            animation: hit 0.3s forwards;
        }
        @keyframes hit {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Бильярдный бой шаров</h1>
    <div id="arena">
        <div id="ball1" class="ball">1</div>
        <div id="ball2" class="ball">2</div>
    </div>
    <button id="startBtn">Старт</button>
    <button id="stopBtn" disabled>Стоп</button>

    <script>
        // Настройки
        const config = {
            width: 800,
            height: 500,
            friction: 0.99,
            ballSpeed: 5,
            bulletSpeed: 10,
            fireRate: 30,
            ballRadius: 20
        };

        // Состояние игры
        const balls = [
            { id: 1, x: 200, y: 250, dx: 0, dy: 0, health: 100, cooldown: 0 },
            { id: 2, x: 600, y: 250, dx: 0, dy: 0, health: 100, cooldown: 0 }
        ];
        const bullets = [];
        let gameRunning = false;
        let animationId;

        // Инициализация
        function initGame() {
            // Сброс позиций и скоростей
            balls[0].x = 200;
            balls[0].y = 250;
            balls[0].dx = (Math.random() - 0.5) * config.ballSpeed;
            balls[0].dy = (Math.random() - 0.5) * config.ballSpeed;
            balls[0].health = 100;
            
            balls[1].x = 600;
            balls[1].y = 250;
            balls[1].dx = (Math.random() - 0.5) * config.ballSpeed;
            balls[1].dy = (Math.random() - 0.5) * config.ballSpeed;
            balls[1].health = 100;
            
            // Очистка пуль
            bullets.length = 0;
            document.querySelectorAll('.bullet, .hit-effect').forEach(el => el.remove());
            
            // Показ шаров
            document.getElementById('ball1').style.display = '';
            document.getElementById('ball2').style.display = '';
        }

        // Игровой цикл
        function gameLoop() {
            // Движение шаров
            balls.forEach(ball => {
                if (ball.health <= 0) return;
                
                ball.x += ball.dx;
                ball.y += ball.dy;
                
                // Отражение от стен
                if (ball.x < config.ballRadius || ball.x > config.width - config.ballRadius) {
                    ball.dx = -ball.dx * 0.95;
                    ball.x = Math.max(config.ballRadius, Math.min(config.width - config.ballRadius, ball.x));
                }
                if (ball.y < config.ballRadius || ball.y > config.height - config.ballRadius) {
                    ball.dy = -ball.dy * 0.95;
                    ball.y = Math.max(config.ballRadius, Math.min(config.height - config.ballRadius, ball.y));
                }
                
                // Трение
                ball.dx *= config.friction;
                ball.dy *= config.friction;
                
                // Обновление позиции
                const ballElement = document.getElementById(`ball${ball.id}`);
                ballElement.style.transform = `translate(${ball.x}px, ${ball.y}px)`;
                
                // Стрельба
                if (ball.cooldown > 0) {
                    ball.cooldown--;
                } else if (Math.random() > 0.98) {
                    const enemy = balls.find(b => b.id !== ball.id);
                    if (enemy && enemy.health > 0) {
                        const dx = enemy.x - ball.x;
                        const dy = enemy.y - ball.y;
                        const angle = Math.atan2(dy, dx);
                        
                        bullets.push({
                            x: ball.x,
                            y: ball.y,
                            dx: Math.cos(angle) * config.bulletSpeed,
                            dy: Math.sin(angle) * config.bulletSpeed,
                            owner: ball.id
                        });
                        
                        const bulletElement = document.createElement('div');
                        bulletElement.className = 'bullet';
                        bulletElement.style.transform = `translate(${ball.x}px, ${ball.y}px)`;
                        document.getElementById('arena').appendChild(bulletElement);
                        
                        ball.cooldown = config.fireRate;
                    }
                }
            });
            
            // Движение пуль
            const bulletElements = document.querySelectorAll('.bullet');
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.x += bullet.dx;
                bullet.y += bullet.dy;
                
                // Обновление позиции
                if (bulletElements[i]) {
                    bulletElements[i].style.transform = `translate(${bullet.x}px, ${bullet.y}px)`;
                }
                
                // Проверка попадания
                const targetBall = balls.find(b => b.id !== bullet.owner);
                if (targetBall && targetBall.health > 0) {
                    const dx = targetBall.x - bullet.x;
                    const dy = targetBall.y - bullet.y;
                    const distance = Math.sqrt(dx*dx + dy*dy);
                    
                    if (distance < config.ballRadius) {
                        // Эффект попадания
                        const hitEffect = document.createElement('div');
                        hitEffect.className = 'hit-effect';
                        hitEffect.style.transform = `translate(${bullet.x}px, ${bullet.y}px)`;
                        document.getElementById('arena').appendChild(hitEffect);
                        setTimeout(() => hitEffect.remove(), 300);
                        
                        targetBall.health -= 10;
                        
                        if (targetBall.health <= 0) {
                            document.getElementById(`ball${targetBall.id}`).style.display = 'none';
                            stopGame();
                            setTimeout(() => alert(`Шар ${bullet.owner} победил!`), 100);
                            return;
                        }
                        
                        // Удаление пули
                        if (bulletElements[i]) {
                            bulletElements[i].remove();
                        }
                        bullets.splice(i, 1);
                        continue;
                    }
                }
                
                // Удаление за пределами
                if (bullet.x < 0 || bullet.x > config.width || 
                    bullet.y < 0 || bullet.y > config.height) {
                    if (bulletElements[i]) {
                        bulletElements[i].remove();
                    }
                    bullets.splice(i, 1);
                }
            }
            
            if (gameRunning) {
                animationId = requestAnimationFrame(gameLoop);
            }
        }

        // Управление игрой
        function startGame() {
            if (gameRunning) return;
            initGame();
            gameRunning = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            gameLoop();
        }

        function stopGame() {
            gameRunning = false;
            cancelAnimationFrame(animationId);
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }

        // Инициализация
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('stopBtn').addEventListener('click', stopGame);
        
        // Начальное движение
        balls[0].dx = (Math.random() - 0.5) * config.ballSpeed;
        balls[0].dy = (Math.random() - 0.5) * config.ballSpeed;
        balls[1].dx = (Math.random() - 0.5) * config.ballSpeed;
        balls[1].dy = (Math.random() - 0.5) * config.ballSpeed;
    </script>
</body>
</html>
