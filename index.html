<!DOCTYPE html>
<html>
<head>
    <title>Быстрый бой шаров</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #121212;
            color: white;
            margin: 0;
            padding: 20px;
        }
        #arena {
            width: 800px;
            height: 500px;
            margin: 20px auto;
            background: #0a0a0a;
            border: 3px solid #333;
            position: relative;
            overflow: hidden;
        }
        .robot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            will-change: transform;
        }
        #robot1 {
            background: #2196F3;
            box-shadow: 0 0 10px #2196F3;
        }
        #robot2 {
            background: #FF5722;
            box-shadow: 0 0 10px #FF5722;
        }
        .bullet {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: absolute;
            background: yellow;
            will-change: transform;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Быстрый бой шаров</h1>
    <div id="arena"></div>
    <button id="startBtn">Старт</button>
    <button id="stopBtn" disabled>Стоп</button>

    <script>
        // Настройки с увеличенной скоростью
        const config = {
            width: 800,
            height: 500,
            friction: 0.99,  // Уменьшил трение для более долгого движения
            robotSpeed: 8,   // Увеличил скорость шаров
            bulletSpeed: 12, // Увеличил скорость пуль
            fireRate: 20     // Увеличил частоту стрельбы
        };

        // Игровые объекты
        let robots = [];
        let bullets = [];
        let gameRunning = false;
        let gameInterval;
        let lastTime = 0;

        // Класс шара
        class Robot {
            constructor(id, x, y) {
                this.id = id;
                this.x = x;
                this.y = y;
                this.dx = (Math.random() - 0.5) * config.robotSpeed;
                this.dy = (Math.random() - 0.5) * config.robotSpeed;
                this.health = 100;
                this.cooldown = 0;
                this.element = document.createElement('div');
                this.element.className = 'robot';
                this.element.id = `robot${id}`;
                this.element.textContent = id;
                document.getElementById('arena').appendChild(this.element);
                this.update();
            }

            update(deltaTime) {
                // Плавное движение с учетом времени кадра
                const frameCorrection = deltaTime / (1000/60);
                
                this.x += this.dx * frameCorrection;
                this.y += this.dy * frameCorrection;
                
                // Отражение от стен с сохранением скорости
                if (this.x < 20 || this.x > config.width - 20) {
                    this.dx = -this.dx;
                    this.x = Math.max(20, Math.min(config.width - 20, this.x));
                }
                if (this.y < 20 || this.y > config.height - 20) {
                    this.dy = -this.dy;
                    this.y = Math.max(20, Math.min(config.height - 20, this.y));
                }
                
                // Применяем трение
                this.dx *= config.friction;
                this.dy *= config.friction;
                
                // Плавное позиционирование
                this.element.style.transform = `translate(${this.x - 20}px, ${this.y - 20}px)`;
            }

            fire(angle) {
                if (this.cooldown <= 0) {
                    this.cooldown = config.fireRate;
                    return {
                        x: this.x,
                        y: this.y,
                        dx: Math.cos(angle) * config.bulletSpeed,
                        dy: Math.sin(angle) * config.bulletSpeed,
                        owner: this.id
                    };
                }
                return null;
            }

            takeDamage(damage) {
                this.health -= damage;
                if (this.health <= 0) {
                    this.element.style.display = 'none';
                    return true;
                }
                return false;
            }
        }

        // Инициализация игры
        function initGame() {
            // Очистка
            document.getElementById('arena').innerHTML = '';
            robots = [];
            bullets = [];
            
            // Создание шаров в случайных позициях
            robots.push(new Robot(1, 100 + Math.random() * 600, 100 + Math.random() * 300));
            robots.push(new Robot(2, 100 + Math.random() * 600, 100 + Math.random() * 300));
        }

        // Игровой цикл
        function gameLoop(timestamp) {
            if (!lastTime) lastTime = timestamp;
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            
            // Движение шаров
            robots.forEach(robot => {
                robot.update(deltaTime);
                if (robot.cooldown > 0) robot.cooldown--;
            });
            
            // Автоматическая стрельба
            if (robots.length === 2) {
                const dx = robots[1].x - robots[0].x;
                const dy = robots[1].y - robots[0].y;
                const distance = Math.sqrt(dx*dx + dy*dy);
                const angle = Math.atan2(dy, dx);
                
                if (Math.random() > 0.95) {
                    const bullet = robots[0].fire(angle);
                    if (bullet) {
                        bullets.push(bullet);
                        createBullet(bullet);
                    }
                }
                
                const dx2 = robots[0].x - robots[1].x;
                const dy2 = robots[0].y - robots[1].y;
                const angle2 = Math.atan2(dy2, dx2);
                
                if (Math.random() > 0.95) {
                    const bullet = robots[1].fire(angle2);
                    if (bullet) {
                        bullets.push(bullet);
                        createBullet(bullet);
                    }
                }
            }
            
            // Обновление пуль
            updateBullets(deltaTime);
            
            if (gameRunning) {
                requestAnimationFrame(gameLoop);
            }
        }

        // Создание пули
        function createBullet(bullet) {
            const el = document.createElement('div');
            el.className = 'bullet';
            el.style.transform = `translate(${bullet.x}px, ${bullet.y}px)`;
            document.getElementById('arena').appendChild(el);
        }

        // Обновление пуль
        function updateBullets(deltaTime) {
            const frameCorrection = deltaTime / (1000/60);
            const bulletElements = document.querySelectorAll('.bullet');
            
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.x += bullet.dx * frameCorrection;
                bullet.y += bullet.dy * frameCorrection;
                
                // Обновление позиции
                if (bulletElements[i]) {
                    bulletElements[i].style.transform = `translate(${bullet.x}px, ${bullet.y}px)`;
                }
                
                // Проверка попадания
                if (robots.length > 1) {
                    const targetId = bullet.owner === 1 ? 1 : 0;
                    const enemy = robots[targetId];
                    const dx = enemy.x - bullet.x;
                    const dy = enemy.y - bullet.y;
                    const distance = Math.sqrt(dx*dx + dy*dy);
                    
                    if (distance < 30 && enemy.element.style.display !== 'none') {
                        if (enemy.takeDamage(10)) {
                            stopGame();
                            setTimeout(() => alert(`Шар ${bullet.owner} победил!`), 100);
                            return;
                        }
                        document.getElementById('arena').removeChild(bulletElements[i]);
                        bullets.splice(i, 1);
                        continue;
                    }
                }
                
                // Удаление за пределами
                if (bullet.x < 0 || bullet.x > config.width || 
                    bullet.y < 0 || bullet.y > config.height) {
                    if (bulletElements[i]) {
                        document.getElementById('arena').removeChild(bulletElements[i]);
                    }
                    bullets.splice(i, 1);
                }
            }
        }

        // Управление игрой
        function startGame() {
            if (gameRunning) return;
            initGame();
            gameRunning = true;
            lastTime = 0;
            requestAnimationFrame(gameLoop);
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
        }

        function stopGame() {
            gameRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }

        // Инициализация
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('stopBtn').addEventListener('click', stopGame);
    </script>
</body>
</html>
