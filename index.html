<!DOCTYPE html>
<html>
<head>
    <title>Бой шаров</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #121212;
            color: white;
            margin: 0;
            padding: 20px;
        }
        #arena {
            width: 800px;
            height: 500px;
            margin: 20px auto;
            background: #0a0a0a;
            border: 3px solid #333;
            position: relative;
            overflow: hidden;
        }
        .robot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            transition: transform 0.1s;
        }
        #robot1 {
            background: #2196F3;
            box-shadow: 0 0 10px #2196F3;
        }
        #robot2 {
            background: #FF5722;
            box-shadow: 0 0 10px #FF5722;
        }
        .bullet {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: absolute;
            background: yellow;
        }
        .radar {
            position: absolute;
            border-radius: 50%;
            border: 1px dashed rgba(76, 175, 80, 0.3);
            transform: translate(-50%, -50%);
            pointer-events: none;
            animation: radar 2s infinite;
        }
        @keyframes radar {
            0% { opacity: 0.7; transform: translate(-50%, -50%) scale(0.1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Бой шаров</h1>
    <div id="arena"></div>
    <button id="startBtn">Старт</button>
    <button id="stopBtn" disabled>Стоп</button>

    <script>
        // Настройки
        const config = {
            width: 800,
            height: 500,
            friction: 0.98,
            robotSpeed: 3,
            bulletSpeed: 7,
            fireRate: 30,
            scanRange: 200
        };

        // Игровые объекты
        let robots = [];
        let bullets = [];
        let gameRunning = false;
        let gameInterval;

        // Класс шара
        class Robot {
            constructor(id, x, y) {
                this.id = id;
                this.x = x;
                this.y = y;
                this.dx = (Math.random() - 0.5) * config.robotSpeed;
                this.dy = (Math.random() - 0.5) * config.robotSpeed;
                this.health = 100;
                this.cooldown = 0;
                this.element = document.createElement('div');
                this.element.className = 'robot';
                this.element.id = `robot${id}`;
                this.element.textContent = id;
                document.getElementById('arena').appendChild(this.element);
                this.update();
            }

            update() {
                // Движение с отражением от стен
                this.x += this.dx;
                this.y += this.dy;
                
                if (this.x < 20 || this.x > config.width - 20) {
                    this.dx = -this.dx * 0.9;
                    this.x = Math.max(20, Math.min(config.width - 20, this.x));
                }
                if (this.y < 20 || this.y > config.height - 20) {
                    this.dy = -this.dy * 0.9;
                    this.y = Math.max(20, Math.min(config.height - 20, this.y));
                }
                
                // Трение
                this.dx *= config.friction;
                this.dy *= config.friction;
                
                this.element.style.left = `${this.x - 20}px`;
                this.element.style.top = `${this.y - 20}px`;
            }

            scan(enemy) {
                // Визуализация радара
                const radar = document.createElement('div');
                radar.className = 'radar';
                radar.style.left = `${this.x}px`;
                radar.style.top = `${this.y}px`;
                radar.style.width = `${config.scanRange * 2}px`;
                radar.style.height = `${config.scanRange * 2}px`;
                document.getElementById('arena').appendChild(radar);
                setTimeout(() => radar.remove(), 2000);
                
                const dx = enemy.x - this.x;
                const dy = enemy.y - this.y;
                const distance = Math.sqrt(dx*dx + dy*dy);
                
                return {
                    distance,
                    angle: Math.atan2(dy, dx),
                    visible: distance < config.scanRange
                };
            }

            fire(angle) {
                if (this.cooldown <= 0) {
                    this.cooldown = config.fireRate;
                    return {
                        x: this.x,
                        y: this.y,
                        dx: Math.cos(angle) * config.bulletSpeed,
                        dy: Math.sin(angle) * config.bulletSpeed,
                        owner: this.id
                    };
                }
                return null;
            }

            takeDamage(damage) {
                this.health -= damage;
                this.element.style.transform = 'scale(1.3)';
                setTimeout(() => this.element.style.transform = 'scale(1)', 200);
                return this.health <= 0;
            }
        }

        // Инициализация игры
        function initGame() {
            // Очистка
            document.getElementById('arena').innerHTML = '';
            robots = [];
            bullets = [];
            
            // Создание шаров
            robots.push(new Robot(1, 200, 250));
            robots.push(new Robot(2, 600, 250));
        }

        // Игровой цикл
        function gameLoop() {
            // Движение шаров
            robots.forEach(robot => {
                robot.update();
                if (robot.cooldown > 0) robot.cooldown--;
            });
            
            // Логика ИИ
            const scanResult = robots[0].scan(robots[1]);
            if (scanResult.visible && Math.random() > 0.9) {
                const bullet = robots[0].fire(scanResult.angle);
                if (bullet) {
                    bullets.push(bullet);
                    createBullet(bullet);
                }
            }
            
            const scanResult2 = robots[1].scan(robots[0]);
            if (scanResult2.visible && Math.random() > 0.9) {
                const bullet = robots[1].fire(scanResult2.angle);
                if (bullet) {
                    bullets.push(bullet);
                    createBullet(bullet);
                }
            }
            
            // Обновление пуль
            updateBullets();
        }

        // Создание пули
        function createBullet(bullet) {
            const el = document.createElement('div');
            el.className = 'bullet';
            el.style.left = `${bullet.x}px`;
            el.style.top = `${bullet.y}px`;
            document.getElementById('arena').appendChild(el);
        }

        // Обновление пуль
        function updateBullets() {
            const bulletElements = document.querySelectorAll('.bullet');
            
            for (let i = bullets.length - 1; i >= 0; i--) {
                const bullet = bullets[i];
                bullet.x += bullet.dx;
                bullet.y += bullet.dy;
                
                // Обновление позиции
                if (bulletElements[i]) {
                    bulletElements[i].style.left = `${bullet.x}px`;
                    bulletElements[i].style.top = `${bullet.y}px`;
                }
                
                // Проверка попадания
                const enemy = robots[bullet.owner === 1 ? 1 : 0];
                const dx = enemy.x - bullet.x;
                const dy = enemy.y - bullet.y;
                const distance = Math.sqrt(dx*dx + dy*dy);
                
                if (distance < 30) {
                    if (enemy.takeDamage(10)) {
                        stopGame();
                        setTimeout(() => alert(`Шар ${bullet.owner} победил!`), 100);
                        return;
                    }
                    bullets.splice(i, 1);
                    bulletElements[i]?.remove();
                }
                // Удаление за пределами
                else if (bullet.x < 0 || bullet.x > config.width || 
                         bullet.y < 0 || bullet.y > config.height) {
                    bullets.splice(i, 1);
                    bulletElements[i]?.remove();
                }
            }
        }

        // Управление игрой
        function startGame() {
            if (gameRunning) return;
            initGame();
            gameRunning = true;
            gameInterval = setInterval(gameLoop, 50);
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
        }

        function stopGame() {
            if (!gameRunning) return;
            clearInterval(gameInterval);
            gameRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }

        // Инициализация
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('stopBtn').addEventListener('click', stopGame);
    </script>
</body>
</html>
