<!DOCTYPE html>
<html>
<head>
    <title>Real Stickman Fight</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; width: 100%; height: 100%; }
    </style>
</head>
<body>
    <canvas id="game"></canvas>

    <script>
        // Настройки
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Игроки
        const players = [
            { x: 300, y: 300, speed: 5, color: '#00f7ff', health: 100, direction: 1, state: 'run', attackCooldown: 0, isJumping: false },
            { x: 700, y: 300, speed: 5, color: '#ff2a6d', health: 100, direction: -1, state: 'run', attackCooldown: 0, isJumping: false }
        ];

        // Эффекты
        const effects = {
            swords: [],
            blood: [],
            bullets: []
        };

        // Физика
        function updatePhysics() {
            players.forEach(p => {
                // Гравитация
                if (p.y < 300) {
                    p.y += 5;
                } else {
                    p.y = 300;
                    p.isJumping = false;
                }

                // Границы экрана
                p.x = Math.max(50, Math.min(canvas.width - 50, p.x));
            });
        }

        // ИИ
        function updateAI() {
            players.forEach((p, i) => {
                const enemy = players[i === 0 ? 1 : 0];
                const distance = Math.abs(p.x - enemy.x);

                // Преследование
                if (distance > 150) {
                    p.state = 'run';
                    p.direction = p.x < enemy.x ? 1 : -1;
                    p.x += p.direction * p.speed;
                }
                // Атака
                else if (distance < 100 && p.attackCooldown === 0) {
                    p.state = 'attack';
                    p.attackCooldown = 30;
                    effects.swords.push({
                        x: p.x,
                        y: p.y,
                        direction: p.direction,
                        frame: 0
                    });
                    enemy.health -= 10;
                    
                    // Кровь
                    for (let j = 0; j < 10; j++) {
                        effects.blood.push({
                            x: enemy.x + Math.random() * 40 - 20,
                            y: enemy.y + Math.random() * 30,
                            alpha: 1
                        });
                    }
                }
                // Прыжок
                else if (!p.isJumping && Math.random() < 0.02) {
                    p.isJumping = true;
                    p.y -= 80;
                }

                if (p.attackCooldown > 0) p.attackCooldown--;
            });
        }

        // Отрисовка
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Игроки
            players.forEach(p => {
                // Ноги (анимация бега)
                const legFrame = Math.sin(Date.now() * 0.005) * 15;
                ctx.fillStyle = p.color;
                
                // Тело
                ctx.fillRect(p.x - 10, p.y, 20, 50);
                
                // Голова
                ctx.beginPath();
                ctx.arc(p.x, p.y - 15, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // Руки
                ctx.fillRect(p.x - 25, p.y + 10, 15, 5);
                ctx.fillRect(p.x + 10, p.y + 10, 15, 5);
                
                // Ноги
                ctx.fillRect(p.x - 15, p.y + 50, 15, 5);
                ctx.fillRect(p.x, p.y + 50 + legFrame, 15, 5);
                
                // HP-бар
                ctx.fillStyle = 'red';
                ctx.fillRect(p.x - 25, p.y - 30, 50, 5);
                ctx.fillStyle = 'lime';
                ctx.fillRect(p.x - 25, p.y - 30, (p.health / 100) * 50, 5);
            });

            // Мечи
            effects.swords.forEach((sword, i) => {
                ctx.fillStyle = '#fff';
                ctx.fillRect(
                    sword.x + (sword.direction * (20 + sword.frame * 8)),
                    sword.y + 10,
                    40 * sword.direction,
                    5
                );
                sword.frame++;
                if (sword.frame > 5) effects.swords.splice(i, 1);
            });

            // Кровь
            effects.blood.forEach((b, i) => {
                ctx.fillStyle = `rgba(255, 0, 0, ${b.alpha})`;
                ctx.fillRect(b.x, b.y, 5, 5);
                b.alpha -= 0.02;
                if (b.alpha <= 0) effects.blood.splice(i, 1);
            });
        }

        // Игровой цикл
        function gameLoop() {
            updatePhysics();
            updateAI();
            draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
